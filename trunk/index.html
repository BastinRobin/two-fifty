<!doctype html>
<html><head>
<title>Track IMDb Top 250 movies you have seen</title>
<link rel="stylesheet" type="text/css" media="all" href="http://www.s-anand.net/960-full.css">
<style>
h1 { margin-bottom: 10px; border-bottom: 1px solid #aaa; }
h1 a { text-decoration: none; }
h2 { margin-bottom: 5px; font-size: 16px; }
.seen, .seen * { text-decoration: line-through; color: #aaa; }
p { margin-bottom: 2px; }
th { _cursor: hand; cursor: pointer; }
.login { display: block; border: 4px outset #ccf; background-color: #555588; color: #fff; -moz-border-radius: 50px; text-align: center; text-decoration: none; font-size: 14px; font-weight: bold; }
.login:hover { border: 4px solid #ccf; }
.login:active { border: 4px inset #ccf; }
#change_name { display: none; }
.box { background-color: #999; float:right; text-align: right; color: #fff; font-size: 90%; }
.valign_middle { vertical-align: middle; }
#top_watchers td { white-space: nowrap; padding-right: 5px; }
</style>
<!-- script src="http://asset.userfly.com/users/12427/userfly.js" type="text/javascript"></script -->
<style type='text/css'>@import url('http://s3.amazonaws.com/getsatisfaction.com/feedback/feedback.css');</style>
<script src='http://s3.amazonaws.com/getsatisfaction.com/feedback/feedback.js' type='text/javascript'></script>
<script type="text/javascript" charset="utf-8">
  var tab_options = {}
  tab_options.placement = "left";  // left, right, bottom, hidden
  tab_options.color = "#222"; // hex (#FF0000) or color (red)
  GSFN.feedback('http://getsatisfaction.com/twofifty/feedback/topics/new?display=overlay&style=idea', tab_options);
</script>
<script src="http://kryogenix.org/code/browser/sorttable/sorttable.js"></script>
</head><body>
<div class="container_16">
    <div class="grid_16">
        <h1>Track the <a href="http://www.imdb.com/chart/top">IMDb Top 250</a></h1>
    </div>
    <div class="grid_10">
        {% if person %}
            <p><label for="filter">Filter:</label>
            <select id="filter">
                <option value="all"   >Show all         movies</option>
                <option value="unseen">Show only unseen movies</option>
                <option value="seen"  >Show only seen   movies</option>
            </select>
            {{ person_disp }} has seen <span id="count">{{ count }}</span> / 250 movies.</p>
        {% endif %}
        {% if can_change %}
            <p><i>Click on a movie to mark it as <span class="seen">seen</span>. Click again to toggle.</i></p>
        {% endif %}
        <table id="movies" class="sortable"><thead>
            <tr><th>Rank</th><th>Year</th><th>Movie</th><th></th><th>Rating</th><th>Votes</th></tr>
        </thead><tbody>
            {% for movie in movies %}
                <tr class="{% if movie.seen %}seen{% else %}unseen{% endif %}"><td>{{ movie.rank }}
                </td><td>{{ movie.year }}
                </td><td>{% if can_change %}<a class="toggle" title="Click to mark as seen or unseen" data={{ movie.url }} href="#">{{ movie.title }}</a>
                         {% else %}{{ movie.title }}
                         {% endif %}
                </td><td><a target="_blank" title="Open IMDb page in new window" href="http://www.imdb.com{{ movie.url }}">info</a>
                </td><td>{{ movie.rating }}
                </td><td>{{ movie.votes }}
                </td></tr>
            {% endfor %}
        </tbody></table>
    </div>
    <div class="grid_6">
        {% if logged_in %}
            <p>You are logged in as <span id="disp_name">{{ user_disp }}</span>. <a href='#' id="show_change_form">Change name</a> | <a href="/logout">Logout</a></p>
            <form id="change_name" action="/" method="post"><input id="disp" name="disp" value="{{ user_disp }}"><input type="submit" value="Change"></form>
        {% else %}
            <a class="login" href="/login">Log in to track movies you have watched</a>
            <p><i>This application lets you mark movies that you have seen on the <a href="http://www.imdb.com/chart/top">IMDb Top 250</a>. You can see which movies you've missed out, and compare how many others have seen.</i></p>
        {% endif %}

        <h2>Top movie watchers</h2>
        <table id="top_watchers">
        {% for person in top_watchers %}
            <tr><td><div class="box valign_middle" style="width:{{ person.num }}px">{{ person.num }} &nbsp;</div></td><td class="valign_middle"><a href="/user/{{ person.user.email }}">{% firstof person.disp person.user.nickname %}</a></td></tr>
        {% endfor %}
        </table>

        <h2>Recently activity</h2>
        <ul id="recent_users">
        {% for person in recent_users %}
            <li><a href="/user/{{ person.user.email }}">{% firstof person.disp person.user.nickname %}</a> ({{ person.num }} / 250)</li>
        {% endfor %}
        </ul>
    </div>
</div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
<script>
{% if person %}
    $('#filter').change(function(e) {
        switch($(this).find('option:selected').attr('value')) {
            case 'all':         $('tr.seen,tr.unseen').show(); break;
            case 'seen':     $('tr.seen').show(); $('tr.unseen').hide(); break;
            case 'unseen':   $('tr.seen').hide(); $('tr.unseen').show(); break;
        }
    });
{% endif %}
{% if can_change %}
    $('#movies a.toggle').click(function(e) {
        e.preventDefault();
        var tgt = $(e.target), url = tgt.attr('data');
        tgt.parent().append('<img src="loading-small.gif" alt="working..." class="working">')
        $.post('/', {movie: url}, function(response) {
            if (response == url) {
                var tr = tgt.parents('tr').eq(0);
                if      (tr.hasClass('seen'  )) { tr.addClass('unseen').removeClass('seen'  ); }
                else if (tr.hasClass('unseen')) { tr.addClass('seen'  ).removeClass('unseen'); }
                tr.find('.working').remove();
                $('#count').text($('tr.seen').length);
            }
        })
    });
{% endif %}
{% if logged_in %}
    $('#show_change_form').click(function() { $('#change_name').toggle(); });
{% endif %}
$("#movies tr:even").css("background-color", "#eef");
$('#movies thead tr').css({"background-color": "#558", "color": "white"});
</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">try { var pageTracker = _gat._getTracker("UA-7269195-1"); pageTracker._trackPageview(); } catch(err) {}</script>
</body></html>
